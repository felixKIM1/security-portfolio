# 🔍 LB DSR 환경에서 VPN 사용자의 접속 불가 이슈 해결 사례

## 📝 개요

VPN 사용자에게 새로운 정책을 적용한 이후, 특정 서버에 접속할 수 없는 문제가 발생했습니다.  
문제의 원인을 분석하고, DSR(Direct Server Return) 방식의 로드밸런서 구조로 인한 이슈임을 파악하여 해결한 사례입니다.

이 문서는 해당 문제의 재현 환경, 점검 과정, 최종 원인 및 해결책, 그리고 DSR 구조의 이해를 중심으로 정리합니다.

---

## 📌 문제 상황

- **사용자 환경**: VPN 접속 사용자 (정상 연결 및 IP 할당 확인됨)
- **접속 대상 서버**: IDC 환경, 방화벽 보호존 X
- **접속 문제**: VPN 연결은 정상이나, 특정 서버 도메인 접근 불가

---

## 🛠️ 점검 및 분석 과정

1. ✅ VPN 측 ACL 및 라우팅 정상 수신 확인  
2. ✅ 브라우저 캐시 및 쿠키 초기화 후 재접속  
3. ✅ `nslookup`으로 도메인 응답 확인 → DNS 문제 없음  
4. ✅ `netstat -r`로 클라이언트 라우팅 테이블 확인 -> 로컬 라우트 우선 적용 가능성 점검

> ⚠️ 위 점검에도 불구하고 문제 지속 발생

---

## 🧩 원인 분석 및 해결

- 대상 서버 IP를 분석한 결과, 해당 IP는 LB(VIP)로 확인됨
- 실제 트래픽 도착지는 **방화벽 보호 존 내부의 타겟 그룹**
- **DSR 방식**으로 동작 중인 LB로 인해, 응답이 반환되지 못함

### ✅ 조치 사항

- 클라이언트 → 타겟 그룹으로 직접 접근 허용 정책 추가
- LB VIP → 클라이언트 응답을 위한 **아웃바운드 정책 추가**
- 이후 정상 통신 확인

---

## 📚 DSR vs NAT 방식 비교

| 항목 | DSR (Direct Server Return) | NAT |
|------|----------------------------|-----|
| 응답 경로 | 서버 → 클라이언트 직접 | 서버 → LB → 클라이언트 |
| 성능 | 고속 응답 가능 (병목 없음) | LB 병목 가능성 있음 |
| 원본 IP 유지 | 가능 | 불가 (기본적으로 NAT IP로 변환됨) |
| 설정 복잡도 | 높음 (Loopback, ARP 설정 등 필요) | 상대적으로 간단 |
